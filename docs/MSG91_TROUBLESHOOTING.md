# MSG91 Troubleshooting Guide

## üö® **Common Issues & Solutions**

### **Issue 1: SMS Not Delivered Despite API Success**

#### **Symptoms:**
- ‚úÖ API returns success response
- ‚ùå SMS not received on mobile
- ‚úÖ OTP works when entered (generated by server)

#### **Root Causes:**

##### **A. Wrong API Endpoint:**
```javascript
// ‚ùå WRONG - Flow API (requires template approval)
const url = 'https://api.msg91.com/api/v5/flow/';

// ‚úÖ CORRECT - Simple SMS API
const url = 'https://api.msg91.com/api/sendhttp.php';
```

##### **B. Sender ID Not Approved:**
- **Issue:** "PERSDB" might not be approved
- **Solution:** Use a different sender ID or get approval

##### **C. Account Issues:**
- **Issue:** Insufficient balance or account not activated
- **Solution:** Check MSG91 dashboard

#### **Solutions:**

##### **1. Use Correct API Endpoint:**
```javascript
// Simple HTTP API (recommended)
const url = 'https://api.msg91.com/api/sendhttp.php';
const params = new URLSearchParams({
  authkey: process.env.MSG91_AUTH_KEY,
  mobiles: phoneNumber,
  message: message,
  sender: process.env.MSG91_SENDER_ID || 'PERSDB',
  route: process.env.MSG91_ROUTE || '4',
  country: '91'
});

const response = await axios.get(`${url}?${params.toString()}`);
```

##### **2. Try Different Sender ID:**
```bash
# Try these sender IDs
MSG91_SENDER_ID=MSG91S  # Default MSG91 sender
MSG91_SENDER_ID=TXTLCL  # TextLocal sender
MSG91_SENDER_ID=WEBSMS  # WebSMS sender
```

##### **3. Check Account Status:**
1. **Login** to MSG91 dashboard
2. **Check** account balance
3. **Verify** sender ID approval
4. **Check** delivery reports

### **Issue 2: Invalid Auth Key Error**

#### **Symptoms:**
- ‚ùå "Invalid Auth Key" error
- ‚ùå 401 Unauthorized response

#### **Solutions:**

##### **1. Verify Auth Key:**
```bash
# Check your auth key format
echo $MSG91_AUTH_KEY
# Should be a string like: "1234567890abcdef"
```

##### **2. Get Correct Auth Key:**
1. **Login** to MSG91 dashboard
2. **Go to** API section
3. **Copy** the auth key
4. **Update** environment variable

### **Issue 3: Sender ID Issues**

#### **Symptoms:**
- ‚ùå "Invalid Sender ID" error
- ‚ùå SMS not delivered

#### **Solutions:**

##### **1. Use Approved Sender ID:**
```bash
# Try these approved sender IDs
MSG91_SENDER_ID=MSG91S  # MSG91 default
MSG91_SENDER_ID=TXTLCL  # TextLocal
MSG91_SENDER_ID=WEBSMS  # WebSMS
MSG91_SENDER_ID=SPROUT  # Sprout
```

##### **2. Get Sender ID Approved:**
1. **Login** to MSG91 dashboard
2. **Go to** Sender ID section
3. **Request** approval for "PERSDB"
4. **Wait** for approval (usually 24-48 hours)

### **Issue 4: Route Issues**

#### **Symptoms:**
- ‚ùå SMS not delivered
- ‚ùå Wrong route error

#### **Solutions:**

##### **1. Try Different Routes:**
```bash
# Route options
MSG91_ROUTE=1  # Promotional
MSG91_ROUTE=4  # Transactional (recommended)
MSG91_ROUTE=5  # International
```

##### **2. Check Route Availability:**
1. **Login** to MSG91 dashboard
2. **Check** available routes
3. **Verify** route permissions

## üîß **Debugging Steps**

### **Step 1: Check Environment Variables**
```bash
# Verify all MSG91 variables are set
echo "Auth Key: $MSG91_AUTH_KEY"
echo "Sender ID: $MSG91_SENDER_ID"
echo "Route: $MSG91_ROUTE"
echo "Flow ID: $MSG91_FLOW_ID"
```

### **Step 2: Test API Directly**
```bash
# Test MSG91 API directly
curl "https://api.msg91.com/api/sendhttp.php?authkey=YOUR_AUTH_KEY&mobiles=9876543210&message=Test%20SMS&sender=PERSDB&route=4&country=91"
```

### **Step 3: Check MSG91 Dashboard**
1. **Login** to MSG91 dashboard
2. **Go to** Reports section
3. **Check** delivery status
4. **Look for** error messages

### **Step 4: Test with Different Sender ID**
```bash
# Try with different sender ID
MSG91_SENDER_ID=MSG91S
```

## üìä **API Response Analysis**

### **Successful Response:**
```javascript
// HTTP API success
"SMS sent successfully"

// JSON API success
{
  "message": "3569667542716f634d4d6f4e",
  "type": "success"
}
```

### **Error Responses:**
```javascript
// Invalid auth key
"Invalid authentication key"

// Invalid sender ID
"Invalid sender ID"

// Insufficient balance
"Insufficient balance"

// Invalid mobile number
"Invalid mobile number"
```

## üöÄ **Quick Fixes**

### **Fix 1: Use Simple HTTP API**
```javascript
// Replace flow API with simple HTTP API
const url = 'https://api.msg91.com/api/sendhttp.php';
const params = new URLSearchParams({
  authkey: process.env.MSG91_AUTH_KEY,
  mobiles: phoneNumber,
  message: message,
  sender: process.env.MSG91_SENDER_ID || 'PERSDB',
  route: process.env.MSG91_ROUTE || '4',
  country: '91'
});

const response = await axios.get(`${url}?${params.toString()}`);
```

### **Fix 2: Try Different Sender ID**
```bash
# Update environment variable
MSG91_SENDER_ID=MSG91S
```

### **Fix 3: Check Account Balance**
1. **Login** to MSG91 dashboard
2. **Check** account balance
3. **Add** funds if needed

## üìû **Support Contacts**

### **MSG91 Support:**
- **Email:** support@msg91.com
- **Phone:** +91-120-400-4000
- **Documentation:** [https://docs.msg91.com](https://docs.msg91.com)

### **Application Support:**
- **Check** backend logs for detailed error messages
- **Verify** environment variables
- **Test** API endpoints
- **Review** this troubleshooting guide

## üéØ **Next Steps**

### **1. Immediate Actions:**
1. **Update** MSG91 integration to use simple HTTP API
2. **Try** different sender ID (MSG91S)
3. **Check** MSG91 dashboard for account status
4. **Test** SMS delivery

### **2. If Still Not Working:**
1. **Contact** MSG91 support
2. **Check** account approval status
3. **Verify** sender ID approval
4. **Consider** alternative SMS providers

### **3. Fallback Options:**
1. **Use** Twilio as primary provider
2. **Keep** MSG91 as secondary
3. **Implement** multiple provider support
4. **Add** delivery status tracking

---

**Last Updated:** December 2024  
**Version:** 1.0.0  
**Maintained by:** Development Team